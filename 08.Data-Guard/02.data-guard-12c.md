## Oracle Data Guard on 12c: 


### Prerequisites: 
- **Primary Database**: Oracle **12cR2** database installed and configured.
- **Standby Server**: Same Oracle version and software only installed.
- **Network**: Primary and Standby can communicate (TNS entries configured).
- **OS Users**: Oracle software installed under the same user (`oracle`).
- **Database**: Enterprise Edition (required for Data Guard).



### Environment:

| Site             | Primary         | Standby        |
| ---------------- | --------------- | -------------- | 
| SID              | orcl            | orcl           |
| DB_NAME          | orcl            | orcl           |
| DB_UNIQUE_NAME   | orcl            | orcl_dr        | 
| IP               | 10.1.1.10       | 10.1.1.11      |
| HOST NAME        | db01            | db02           | 
| DATABASE VERSION | 12.2.0.1.0      | 12.2.0.1.0     |
| OS VERSION       | OL 7.9          | OL 7.9         |




## Prepare Primary Database:

### Set the Environment Variables:

```
### Add for oracle user:
export TMP=/tmp
export TMPDIR=$TMP

#export ORACLE_HOSTNAME=db01.local

export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/12.2.0.1/db_1

## Oracle SID (instance name)
export ORACLE_SID=orcl        ## <-- Ensure this matches your actual DB SID
export ORACLE_UNQNAME=orcl
export PDB_NAME=pdb1

export NLS_DATE_FORMAT="DD-MON-YYYY HH24:MI:SS"
export TNS_ADMIN=$ORACLE_HOME/network/admin

export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib

## Add Oracle to PATH:
export PATH=$ORACLE_HOME/bin:$PATH:$HOME/.local/bin
```


```
echo $ORACLE_SID
```



### Check DB name and Unique name:

```
show parameter db_name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ---------
db_name                              string      orcl
```



```
show parameter db_unique_name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ---------
db_unique_name                       string      orcl
```


```
show parameter service_name;

NAME                                 TYPE        VALUE
------------------------------------ ----------- -----------
service_names                        string      orcl
```



```
select name, database_role, open_mode from v$database;

NAME                 DATABASE_ROLE    OPEN_MODE
-------------------- ---------------- --------------------
ORCL                 PRIMARY          READ WRITE
```



_Size of database:_
```
select sum(bytes/1024/1024/1024) from dba_segments;

SUM(BYTES/1024/1024/1024)
-------------------------
               1.24291992
```



### Enable Archivelog:
```
archive log list 


Database log mode              No Archive Mode
Automatic archival             Disabled
Archive destination            /u01/app/oracle/product/12.2.0.1/db_1/dbs/arch
Oldest online log sequence     1
Current log sequence           2
```


```
SELECT log_mode FROM v$database;

LOG_MODE
------------
NOARCHIVELOG
```



_If database is not running in archive log mode then change it in archive log mode using the below steps:_
```
shutdown immediate;

startup mount;

alter database archivelog;
alter database open;
```


```
select log_mode from v$database;

LOG_MODE
------------
ARCHIVELOG
```



### Enable force logging:

```
select force_logging from v$database; 

FORCE_LOGGING
----------------
NO
```


```
ALTER DATABASE FORCE LOGGING; 
```


### Enable flashback:

```
select flashback_on from v$database;

FLASHBACK_ON
------------------
NO
```



**`DB_RECOVERY_FILE_DEST`:**

The Oracle automatically stores inside `/u01/app/oracle/fast_recovery_area`: 
- Archived logs
- Flashback logs
- RMAN backups
- Control file autobackups 



```
show parameter db_recovery;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------
db_recovery_file_dest                string
db_recovery_file_dest_size           big integer 0
```



```
alter system set db_recovery_file_dest_size=10g scope=both;

alter system set db_recovery_file_dest='/u01/app/oracle/fast_recovery_area' scope=both;
```


```
alter database flashback on;
```






### Add Standby Redo Log:

```
select group#, member from v$logfile;

    GROUP# MEMBER
---------- --------------------------------------------------
         3 /u01/app/oracle/oradata/orcl/redo03.log
         2 /u01/app/oracle/oradata/orcl/redo02.log
         1 /u01/app/oracle/oradata/orcl/redo01.log
```



```
select group#, thread#, bytes/1024/1024, members, status from v$log;

    GROUP#    THREAD# BYTES/1024/1024    MEMBERS STATUS
---------- ---------- --------------- ---------- --------------------
         1          1             200          1 INACTIVE
         2          1             200          1 CURRENT
         3          1             200          1 UNUSED
```



```
alter database add standby logfile GROUP 4 ('/u01/app/oracle/oradata/orcl/stb_redo4.log') size 200m; 
alter database add standby logfile GROUP 5 ('/u01/app/oracle/oradata/orcl/stb_redo5.log') size 200m; 
alter database add standby logfile GROUP 6 ('/u01/app/oracle/oradata/orcl/stb_redo6.log') size 200m; 
alter database add standby logfile GROUP 7 ('/u01/app/oracle/oradata/orcl/stb_redo7.log') size 200m; 
```


_If delete:_
```
ALTER DATABASE DROP STANDBY LOGFILE GROUP 4;
ALTER DATABASE DROP STANDBY LOGFILE GROUP 5;
ALTER DATABASE DROP STANDBY LOGFILE GROUP 6;
ALTER DATABASE DROP STANDBY LOGFILE GROUP 7;
```




```
select group#, thread#, SEQUENCE#, ARCHIVED, status from v$standby_log;

    GROUP#    THREAD#  SEQUENCE# ARC STATUS
---------- ---------- ---------- --- --------------------
         4          0          0 YES UNASSIGNED
         5          0          0 YES UNASSIGNED
         6          0          0 YES UNASSIGNED
         7          0          0 YES UNASSIGNED
```





### Standby file management:

```
show parameter standby

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
enabled_PDBs_on_standby              string      *
standby_archive_dest                 string      ?#/dbs/arch
standby_db_preserve_states           string      NONE
standby_file_management              string      MANUAL
```



_Make sure the `STANDBY_FILE_MANAGEMENT` parameter is set:_
```
alter system set standby_file_management=auto scope=both;
```




### Change below dynamic parameters:

```
ALTER SYSTEM SET db_unique_name='orcl' SCOPE=SPFILE;
```



```
show parameter log_archive_config;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ----------
log_archive_config                   string
```



_This parameter defines which databases are in data guard configuration:_
```
alter system set log_archive_config='dg_config=(orcl,orcl_dr)' scope=both;
```




**`USE_DB_RECOVERY_FILE_DEST`:**
This keyword is used inside the `LOG_ARCHIVE_DEST_n` parameter to tell **Oracle to store archived redo logs (or backups)** in the **Fast Recovery Area (FRA)** — instead of a custom directory. 

It means: “Store all archived redo logs for this database inside the FRA (Fast Recovery Area) defined by `DB_RECOVERY_FILE_DEST`.” Path to the Fast Recovery Area (FRA) like `/u01/app/oracle/fast_recovery_area`.


**Custom Directory Method:**
If define a specific path in `LOG_ARCHIVE_DEST_n` parameter, this tells Oracle: “Store all archived logs in `/u01/backup/arch/orcl` **instead of the Fast Recovery Area**.”

```
mkdir -p /u01/backup/arch/orcl
```



_Configure redo transport:_
```
//ALTER SYSTEM SET log_archive_dest_1='location=use_db_recovery_file_dest valid_for=(all_logfiles,all_roles) db_unique_name=orcl' scope=both;


ALTER SYSTEM SET LOG_ARCHIVE_DEST_1='LOCATION=/u01/backup/arch/orcl VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=orcl' scope=both;

ALTER SYSTEM SET LOG_ARCHIVE_DEST_2='SERVICE=orcl_dr noaffirm LGWR ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=orcl_dr' scope=both;
```


```
SHOW PARAMETER log_archive_dest_1;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest_1                   string      LOCATION=/u01/backup/arch/orcl
                                                  VALID_FOR=(ALL_LOGFILES,ALL_R
                                                 OLES) DB_UNIQUE_NAME=orcl
```


```
SHOW PARAMETER log_archive_dest_2;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest_2                   string      SERVICE=orcl_dr noaffirm LGWR
                                                 ASYNC VALID_FOR=(ONLINE_LOGFIL
                                                 ES,PRIMARY_ROLE) DB_UNIQUE_NAM
                                                 E=orcl_dr
```




```
ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_1=ENABLE; 

ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2=ENABLE; 
```



```
ALTER SYSTEM SET FAL_SERVER=orcl_dr scope=both; 

ALTER SYSTEM SET FAL_CLIENT=orcl scope=both; 
```






**Set archive format (optional):**
```
ALTER SYSTEM SET LOG_ARCHIVE_FORMAT='%t_%s_%r.arc' SCOPE=SPFILE; 
```



```
SHOW PARAMETER log_archive_format;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ----------------
log_archive_format                   string      %t_%s_%r.arc
```




### File name convert: 

```
select file_name from dba_data_files;

FILE_NAME
---------------------------------------------------
/u01/app/oracle/oradata/orcl/users01.dbf
/u01/app/oracle/oradata/orcl/undotbs01.dbf
/u01/app/oracle/oradata/orcl/system01.dbf
/u01/app/oracle/oradata/orcl/sysaux01.dbf
```



**When You Need Them:**
- If both databases use exactly the same directory structure, you don’t need these.
- If both primary and standby use the same structure (e.g. `/u01/app/oracle/oradata/orcl` on both), then do not set these parameters — leave them unset.
- If paths differ (e.g., primary under `/u01/app/oracle/oradata/orcl` but standby under `/u01/app/oracle/oradata/orcl_dr`), then you must configure them.



```
ALTER SYSTEM SET DB_FILE_NAME_CONVERT='/u01/app/oracle/oradata/orcl_dr','/u01/app/oracle/oradata/orcl' SCOPE=SPFILE;

ALTER SYSTEM SET LOG_FILE_NAME_CONVERT='/u01/app/oracle/oradata/orcl_dr','/u01/app/oracle/oradata/orcl' SCOPE=SPFILE;
```



```
SHOW PARAMETER db_file_name_convert;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
db_file_name_convert                 string      /u01/app/oracle/oradata/orcl_dr, 
                                                 /u01/app/oracle/oradata/orcl
pdb_file_name_convert                string
```


```
SHOW PARAMETER log_file_name_convert;

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_file_name_convert                string      /u01/app/oracle/oradata/orcl_dr, 
                                                 /u01/app/oracle/oradata/orcl
```




Now, take effect to restart the Primary database server.




#### 


_Show the current SCN:_
```
SELECT CURRENT_SCN FROM V$DATABASE;

CURRENT_SCN
-----------
    1657053
```


_Show the checkpoint SCN of datafiles:_
```
SELECT FILE#, CHECKPOINT_CHANGE# FROM V$DATAFILE;

     FILE# CHECKPOINT_CHANGE#
---------- ------------------
         1            1656537
         3            1656537
         4            1656537
         7            1656537
```



```
SELECT file#, name, checkpoint_change#, checkpoint_time FROM v$datafile_header;

     FILE# NAME                                               CHECKPOINT_CHANGE# CHECKPOIN
---------- -------------------------------------------------- ------------------ ---------
         1 /u01/app/oracle/oradata/orcl/system01.dbf                     1656537 08-OCT-25
         3 /u01/app/oracle/oradata/orcl/sysaux01.dbf                     1656537 08-OCT-25
         4 /u01/app/oracle/oradata/orcl/undotbs01.dbf                    1656537 08-OCT-25
         7 /u01/app/oracle/oradata/orcl/users01.dbf                      1656537 08-OCT-25
```



```
select open_mode,current_scn,checkpoint_change#,archive_change#,controlfile_change# from v$database;

OPEN_MODE            CURRENT_SCN CHECKPOINT_CHANGE# ARCHIVE_CHANGE# CONTROLFILE_CHANGE#
-------------------- ----------- ------------------ --------------- -------------------
READ WRITE               1657433            1656537               0             1656609
```


_Check the most recently archived redo log file:_
```
SELECT MAX(sequence#) FROM v$archived_log;
```



_Check current redo sequence on Primary:_
```
SELECT THREAD#, SEQUENCE#, STATUS FROM V$LOG;

   THREAD#  SEQUENCE# STATUS
---------- ---------- ----------------
         1          7 INACTIVE
         1          8 CURRENT
         1          6 INACTIVE
```



### Set parameter REMOTE LOGIN: 
```
ALTER SYSTEM SET REMOTE_LOGIN_PASSWORDFILE=EXCLUSIVE SCOPE=SPFILE;  
```


_If no password file exists, create one via below command and then copy:_
```
orapwd file=$ORACLE_HOME/dbs/orapworcl password=Admin_123 force=y
```


_Copy the password file from primary to standby server:_
```
scp $ORACLE_HOME/dbs/orapworcl oracle@db02:$ORACLE_HOME/dbs
```






### Create PFILE: 
```
sqlplus / as sysdba

create pfile='/home/oracle/initorcl.ora' from spfile;
```


```
scp /home/oracle/initorcl.ora oracle@db02:$ORACLE_HOME/dbs
```



```
cat /home/oracle/initorcl.ora

orcl.__data_transfer_cache_size=0
orcl.__db_cache_size=603979776
orcl.__inmemory_ext_roarea=0
orcl.__inmemory_ext_rwarea=0
orcl.__java_pool_size=16777216
orcl.__large_pool_size=33554432
orcl.__oracle_base='/u01/app/oracle'#ORACLE_BASE set from environment
orcl.__pga_aggregate_target=620756992
orcl.__sga_target=905969664
orcl.__shared_io_pool_size=33554432
orcl.__shared_pool_size=201326592
orcl.__streams_pool_size=0
*.audit_file_dest='/u01/app/oracle/admin/orcl/adump'
*.audit_trail='db'
*.compatible='12.2.0'
*.control_files='/u01/app/oracle/oradata/orcl/control01.ctl','/u01/app/oracle/oradata/orcl/control02.ctl'
*.db_block_size=8192
*.db_file_name_convert='/u01/app/oracle/oradata/orcl_dr','/u01/app/oracle/oradata/orcl'
*.db_name='orcl'
*.db_unique_name='orcl'
*.diagnostic_dest='/u01/app/oracle'
*.dispatchers='(PROTOCOL=TCP) (SERVICE=orclXDB)'
*.fal_client='ORCL'
*.fal_server='ORCL_DR'
*.log_archive_config='dg_config=(orcl,orcl_dr)'
*.log_archive_dest_1='LOCATION=/u01/backup/arch/orcl VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=orcl'
*.log_archive_dest_2='SERVICE=orcl_dr noaffirm LGWR ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=orcl_dr'
*.log_archive_dest_state_1='ENABLE'
*.log_archive_dest_state_2='ENABLE'
*.log_archive_format='%t_%s_%r.arc'
*.log_file_name_convert='/u01/app/oracle/oradata/orcl_dr','/u01/app/oracle/oradata/orcl'
*.memory_target=1451m
*.nls_language='AMERICAN'
*.nls_territory='AMERICA'
*.open_cursors=300
*.processes=300
*.remote_login_passwordfile='EXCLUSIVE'
*.standby_file_management='AUTO'
*.undo_tablespace='UNDOTBS1'

```



### Adding the network entry in primary and standby side (Both servers):


The `$ORACLE_HOME/network/admin/listener.ora` file on the **primary** server contains the following configuration or create listener using `netmgr`: 

```
cat listener.ora

# listener.ora Network Configuration File: /u01/app/oracle/product/12.2.0.1/db_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = orcl)
      (ORACLE_HOME = /u01/app/oracle/product/12.2.0.1/db_1)
      (SID_NAME = orcl)
    )
  )

LISTENER =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = db01)(PORT = 1521))
  )

ADR_BASE_LISTENER = /u01/app/oracle

```



The `$ORACLE_HOME/network/admin/listener.ora` file on the **standby** server contains the following configuration or create listener using `netmgr`. Since the broker will need to connect to the database when it's down, we can't rely on auto-registration with the listener, hence the explicit entry for the database.

```
cat listener.ora

# listener.ora Network Configuration File: /u01/app/oracle/product/12.2.0.1/db_1/network/admin/listener.ora
# Generated by Oracle configuration tools.

SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = orcl_dr)
      (ORACLE_HOME = /u01/app/oracle/product/12.2.0.1/db_1)
      (SID_NAME = orcl_dr)
    )
  )

LISTENER =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = db02)(PORT = 1521))
  )

ADR_BASE_LISTENER = /u01/app/oracle
```





Entries for the **primary and standby** databases are needed in the `$ORACLE_HOME/network/admin/tnsnames.ora` files on both servers. You can create these using the Network Configuration Utility (`netca`) or manually. The following entries were used during this setup. Notice the use of the **SID**, rather than the **SERVICE_NAME** in the entries.  This is important as the broker will need to connect to the databases when they are down, so the services will not be present.



_On Primary Database:_
```
cat tnsnames.ora


ORCL =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = db01)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = orcl)
    )
  )


ORCL_DR =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = db02)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = orcl_dr)
    )
  )
```


_On Standby Database:_
```
cat tnsnames.ora


ORCL =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = db01)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = orcl)
    )
  )


ORCL_DR =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = TCP)(HOST = db02)(PORT = 1521))
    )
    (CONNECT_DATA =
      (SERVICE_NAME = orcl_dr)
    )
  )
```





```
lsnrctl reload LISTENER
lsnrctl status LISTENER
```


```
tnsping orcl
tnsping orcl_dr
```



---
---




## Standby Server Setup:

### Set the Environment Variables:


```
### Add for oracle user:
export TMP=/tmp
export TMPDIR=$TMP

#export ORACLE_HOSTNAME=orcldb.local

export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/12.2.0.1/db_1

## Oracle SID (instance name)
export ORACLE_SID=orcl_dr        ## <-- Ensure this matches your actual DB SID
export ORACLE_UNQNAME=orcl_dr
export PDB_NAME=pdb1

export NLS_DATE_FORMAT="DD-MON-YYYY HH24:MI:SS"
export TNS_ADMIN=$ORACLE_HOME/network/admin

export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib

## Add Oracle to PATH:
export PATH=$ORACLE_HOME/bin:$PATH:$HOME/.local/bin
```








### Set on Standby Database Initialization Parameters: 


```
mv orapworcl orapworcl_dr
mv initorcl.ora initorcl_dr.ora
```


_Make below changes in the pfile:_
```
vim initorcl_dr.ora


*.audit_file_dest='/u01/app/oracle/admin/orcl_dr/adump'
*.audit_trail='db'
*.compatible='12.2.0'
*.control_files='/u01/app/oracle/oradata/orcl_dr/control01.ctl','/u01/app/oracle/oradata/orcl_dr/control02.ctl'
*.db_block_size=8192
*.db_file_name_convert='/u01/app/oracle/oradata/orcl','/u01/app/oracle/oradata/orcl_dr'
*.db_name='orcl'
*.db_unique_name='orcl_dr'
*.diagnostic_dest='/u01/app/oracle'
*.dispatchers='(PROTOCOL=TCP) (SERVICE=orcl_drXDB)'
*.fal_client='ORCL_DR'
*.fal_server='ORCL'
*.log_archive_config='dg_config=(orcl,orcl_dr)'
*.log_archive_dest_1='LOCATION=/u01/backup/arch/orcl_dr VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME=orcl_dr'
*.log_archive_dest_2='SERVICE=orcl noaffirm LGWR ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=orcl'
*.log_archive_dest_state_1='ENABLE'
*.log_archive_dest_state_2='ENABLE'
*.log_archive_format='%t_%s_%r.arc'
*.log_file_name_convert='/u01/app/oracle/oradata/orcl','/u01/app/oracle/oradata/orcl_dr'
*.memory_target=1451m
*.nls_language='AMERICAN'
*.nls_territory='AMERICA'
*.open_cursors=300
*.processes=300
*.remote_login_passwordfile='EXCLUSIVE'
*.standby_file_management='AUTO'
*.undo_tablespace='UNDOTBS1'

```




### Create Directory: 

```
mkdir -p /u01/app/oracle/admin/orcl_dr/adump
mkdir -p /u01/app/oracle/oradata/orcl_dr
mkdir -p /u01/backup/arch/orcl_dr
```





### Start in nomount mode: 

_On standby server:_
```
sqlplus / as sysdba


startup nomount pfile='/u01/app/oracle/product/12.2.0.1/db_1/dbs/initorcl_dr.ora';
```


```
create spfile from pfile;
```


```
shu immediate

startup nomount
```



```
SELECT status FROM v$instance;

STATUS
------------
STARTED
```



```
select instance_name, status, database_status from v$instance;

INSTANCE_NAME    STATUS       DATABASE_STATUS
---------------- ------------ -----------------
orcl_dr          STARTED      ACTIVE
```



```
show parameter ins

NAME                                 TYPE        VALUE
------------------------------------ ----------- -----------------
active_instance_count                integer
cluster_database_instances           integer     1
dst_upgrade_insert_conv              boolean     TRUE
instance_abort_delay_time            integer     0
instance_groups                      string
instance_mode                        string      READ-WRITE
instance_name                        string      orcl_dr
instance_number                      integer     0
instance_type                        string      RDBMS
instant_restore                      boolean     FALSE
open_links_per_instance              integer     4
```



_To check connection standby to primary database:_
```
sqlplus sys/sys@orcl as sysdba
```




### Duplicate primary database via RMAN: (on Standby Database)

```
rman target sys/"sys"@orcl auxiliary sys/"sys"@orcl_dr


Recovery Manager: Release 19.0.0.0.0 - Production on Fri Oct 3 23:18:34 2025
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.

connected to target database: ORCL (DBID=1739863299)
connected to auxiliary database: ORCL (not mounted)
```


```
duplicate target database for standby from active database nofilenamecheck;
```



### Enable MRP on Standby:

```
sqlplus / as sysdba

select name, open_mode, database_role from v$database;

NAME      OPEN_MODE            DATABASE_ROLE
--------- -------------------- ----------------
ORCL      MOUNTED              PHYSICAL STANDBY
```



```
alter database open;
```


_Real-time apply (requires LGWR ASYNC in primary config):_
```
alter database recover managed standby database using current logfile disconnect from session;
```


```
select name, open_mode, database_role from v$database;

NAME      OPEN_MODE            DATABASE_ROLE
--------- -------------------- ----------------
ORCL      READ ONLY WITH APPLY PHYSICAL STANDBY
```






#### Verify standby configuration: 

_Once MRP is started, we must verify which archive log number MRP is applying on standby:_
```
SELECT PROCESS, STATUS, THREAD#, SEQUENCE# FROM V$MANAGED_STANDBY;

PROCESS   STATUS          THREAD#  SEQUENCE#
--------- ------------ ---------- ----------
ARCH      CLOSING               1          5
DGRD      ALLOCATED             0          0
DGRD      ALLOCATED             0          0
ARCH      CONNECTED             0          0
ARCH      CONNECTED             0          0
ARCH      CONNECTED             0          0
RFS       IDLE                  1          6
RFS       IDLE                  0          0
RFS       IDLE                  0          0
RFS       IDLE                  0          0
MRP0      APPLYING_LOG          1          6
```




```
SELECT thread#, sequence#, applied FROM v$archived_log ORDER BY sequence#;

   THREAD#  SEQUENCE# APPLIED
---------- ---------- ---------
         1          3 YES
         1          4 YES
         1          5 IN-MEMORY
```






#### Validating Standby Database with primary: 

_Check the archive destinations to confirm logs are being sent to the standby:_
```
SELECT destination, status, archived_thread#, archived_seq#
FROM v$archive_dest_status
WHERE status <> 'DEFERRED' AND status <> 'INACTIVE';


DESTINATION                    STATUS    ARCHIVED_THREAD# ARCHIVED_SEQ#
------------------------------ --------- ---------------- -------------
/u01/backup/arch/orcl_dr       VALID                    1             5
orcl                           VALID                    0             0
/u01/backup/arch/orcl_dr       VALID                    1             5
```



_Verify Log Gaps at Standby:_
```
SELECT thread#, MAX(sequence#) FROM v$archived_log GROUP BY thread#;

   THREAD# MAX(SEQUENCE#)
---------- --------------
         1              5
```




_Check the most recently archived redo log file:_
```
SELECT MAX(sequence#) FROM v$archived_log;
```



#### Check Data Guard lag on the Standby:

```
SELECT NAME, VALUE, UNIT FROM V$DATAGUARD_STATS;

NAME                    VALUE                UNIT
----------------------  -------------------- ------------------------------
transport lag           +00 00:00:00         day(2) to second(0) interval
apply lag               +00 00:00:00         day(2) to second(0) interval
apply finish time       +00 00:00:00.000     day(2) to second(3) interval
estimated startup time  10                   second
```



#### Check which log sequences are applied: 

```
SELECT THREAD#, SEQUENCE#, APPLIED, COMPLETION_TIME
FROM V$ARCHIVED_LOG
ORDER BY SEQUENCE# DESC;

   THREAD#  SEQUENCE# APPLIED   COMPLETIO
---------- ---------- --------- ---------
         1          7 IN-MEMORY 08-OCT-25
         1          6 YES       08-OCT-25
         1          5 YES       08-OCT-25
         1          4 YES       08-OCT-25
         1          3 YES       08-OCT-25
```




#### Check last received and last applied redo:
```
SELECT
    (SELECT MAX(SEQUENCE#) FROM V$ARCHIVED_LOG WHERE APPLIED='YES') AS "LAST_APPLIED",
    (SELECT MAX(SEQUENCE#) FROM V$ARCHIVED_LOG) AS "LAST_RECEIVED"
FROM DUAL;

LAST_APPLIED LAST_RECEIVED
------------ -------------
           6             7
```






### Ref:
- [Creating Active Data Guard on 12c](https://www.br8dba.com/active-dataguard/)






